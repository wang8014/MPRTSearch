@using MPRTSearch.ViewModel.SPA
@model SearchViewModel
@using (Html.BeginForm("ExcuteSearch", "Main", @FormMethod.Post, new { id = "searchForm", name = "searchForm"}))
{
    <table>
        <tr>
            <td>
                <h2>sökord:</h2>
            </td>
        </tr>
        <tr>
            <td>
                <h2>
                    @Html.TextBoxFor(x => x.SearchText, htmlAttributes: new { @class = "input-lg" })
                </h2>
                <h5>
                    @Html.DisplayFor(x => x.TypeDisplayText):
                    @Html.DropDownListFor(x => x.TypeValue, Model.ListTypeViewModel, htmlAttributes: new { @class = "dropdown-toggle" })
                    @Html.DisplayFor(x => x.LogicDislayTtext):
                    @Html.DropDownListFor(x => x.LogicValue, Model.ListLogic, htmlAttributes: new { @class = "dropdown-toggle" })
                    <br />@Html.ValidationMessageFor(x => x.SearchText)
                </h5>
                <script src="~/Scripts/jquery-3.1.1.js"></script>
                <script src="~/Scripts/jquery.validate.js"></script>
                <script src="~/Scripts/jquery.validate.unobtrusive.js"></script>

                <script>


                    function Valid() {
                        var bValid = $('#searchForm').valid();
                        if (!bValid) {
                            return;
                        }
                        //alert($('#SearchText').val());
                        //alert(window.location.host);
                        $('#UpdateProgressbar').attr('style', 'display:normal');
                        //alert($('#searchForm').attr('action'));
                        $('#searchForm').attr('action', $('#searchForm').attr('action') + '?seaText=' + $('#SearchText').val() + '&page=1');
                        //alert(window.location.host + '/SPA/Main/ExcuteSearch?seaText=' + $('#SearchText').val() + '&page=1');
                        $('#searchForm').submit();
                        //var p1 = {
                        //    SearchText: $('#SearchText').val()
                        //};
                        //var page = e;

                        //$.post("/SPA/Main/Index2", function (p1, page) {
                        //    $(".result").html(data);
                        //});


                        //2019,02,01 ajax update result table
                        //$('#searchForm').url = '/SPA/Main/Index';
                        //$('#searchForm').submit();
                        //jquerys version måste vara 1.*.*
                        //I Mvc:s .Net application default jquerys version är 3.*.*.
                        //Om man använder 3.*.*, då finns det inte funktion valid() i $('#searchForm')
                        //då ska kod visa "valid is not function, TypeError"

                        //var e =
                        //{
                        //    SearchText: $('#SearchText').val()
                        //};
                        ////$.ajax({
                        ////    url: "/SPA/MAIN/ExcuteSearch",
                        ////    type: 'POST',
                        ////    data: { 'Search': e },
                        ////    dataType: 'json',
                        ////    success: function (r) {
                        ////        debugger;
                        ////        $('#ResultTable').empty();
                        ////        for (i = 0; i < r.SearchResults.length; i++) {
                        ////            var newTr = $('<tr></tr>');
                        ////            var newTD = $('<td></td>');
                        ////            var newP = $('<p></p>');
                        ////            var newLink = $('<a class="btn btn-default"></a>');
                        ////            newLink.attr("href", "/Main/GetDetail/" + r.SearchResults[i].ID);
                        ////            newLink.html("kategori:" + r.SearchResults[i].TypeName + '&nbsp;ID=' + r.SearchResults[i].ID);
                        ////            newP.append(newLink);
                        ////            newTD.append(newP);
                        ////            newTD.append("<p>"
                        ////                + r.SearchResults[i].Column01Value
                        ////                + r.SearchResults[i].Column02Value
                        ////                + r.SearchResults[i].Column03Value
                        ////                + r.SearchResults[i].Column04Value
                        ////                + r.SearchResults[i].Column05Value
                        ////                + r.SearchResults[i].Column06Value
                        ////                + r.SearchResults[i].Column07Value
                        ////                + r.SearchResults[i].Column08Value
                        ////                + r.SearchResults[i].Column09Value
                        ////                + r.SearchResults[i].Column10Value
                        ////                + r.SearchResults[i].Column11Value
                        ////                + r.SearchResults[i].Column12Value
                        ////                + r.SearchResults[i].Column13Value
                        ////                + r.SearchResults[i].Column14Value
                        ////                + r.SearchResults[i].Column15Value
                        ////                + r.SearchResults[i].Column16Value
                        ////                + r.SearchResults[i].Column17Value
                        ////                + r.SearchResults[i].Column18Value
                        ////                + r.SearchResults[i].Column19Value
                        ////                + r.SearchResults[i].Column20Value
                        ////                + r.SearchResults[i].Column21Value
                        ////                + r.SearchResults[i].Column22Value
                        ////                + r.SearchResults[i].Column23Value
                        ////                + r.SearchResults[i].Column24Value
                        ////                + r.SearchResults[i].Column25Value
                        ////                + r.SearchResults[i].Column26Value
                        ////                + r.SearchResults[i].Column27Value
                        ////                + r.SearchResults[i].Column28Value
                        ////                + r.SearchResults[i].Column29Value
                        ////                + r.SearchResults[i].Column30Value
                        ////                + r.SearchResults[i].Column31Value
                        ////                + r.SearchResults[i].Column32Value
                        ////                + r.SearchResults[i].Column33Value
                        ////                + r.SearchResults[i].Column34Value
                        ////                + r.SearchResults[i].Column35Value
                        ////                + r.SearchResults[i].Column36Value
                        ////                + r.SearchResults[i].Column37Value
                        ////                + r.SearchResults[i].Column38Value
                        ////                + r.SearchResults[i].Column39Value
                        ////                + "</p>");


                        ////            newTr.append(newTD);


                        ////            $('#ResultTable').append(newTr);
                        ////            newTr = $('<tr></tr>');
                        ////            newTD = $('<td></td>');
                        ////            newP = $('<p>&nbsp;</p>');
                        ////            newTD.append(newP);
                        ////            newTr.append(newTD);
                        ////            $('#ResultTable').append(newTr);
                        ////        }
                        ////    },
                        ////    error: function () {

                        ////    }
                        //});
                    }
                </script>
            </td>
        </tr>
        <tr>
            <td>
                <input type="button" name="BtnSubmit" value="Sök" onclick="return Valid(0);" class="btn btn-primary btn-lg" />
            </td>
        </tr>

    </table>
}
<div id="UpdateProgressbar" style="display:none;">
    <div class="text-center">
        <p class="text-center">
            Sökning pågår, vänta...
        </p><img id="MainContent_Image1" src="~/images/loading1.jpg" />
    </div>
</div>
